<template lang='pug'>
div( 
  v-if='editor'
  class='border border-2 border-accent-dk'
)
  div(
    class='d-flex bg-accent-dk gap-0'
  )
    format-buttons() 
    element-selector()
  editor-content( 
    :editor="editor" 
    class='editor-wrapper'
  )
  FloatingMenu(:editor='editor')

</template>
<script lang='ts' setup>
import { onMounted, ref, onUnmounted, provide } from "vue"
import StarterKit from '@tiptap/starter-kit'
import { Editor, EditorContent, FloatingMenu  } from '@tiptap/vue-3'
import formatButtons from "./format-buttons"
import elementSelector from "./element-selector"

let emit = defineEmits(['update:modelValue'])

let props = defineProps( {
    modelValue: {
      type: String,
      required: true
    },
} )

let editor = ref(false)

let editorConfig = {
  editorProps: {
    attributes: {
      class: '',
    },
  },
  extensions: [
    StarterKit,
  ],
  content: props.modelValue,
  onUpdate: () => emit( 'update:modelValue', editor.value.getHTML() ) ,
}

onMounted( () => {
  editor.value = new Editor(editorConfig)
  console.log(editor.value)
} )

onUnmounted( () => editor.value.destroy() )

provide('tip-tap-editor', editor)

</script>
<style lang='scss'>
.editor-wrapper {
  .ProseMirror {
    padding: 10px;
    outline: none;
    background: var(--bs-grey-lt)
  }
}
</style>