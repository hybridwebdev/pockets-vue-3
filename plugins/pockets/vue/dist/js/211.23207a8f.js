"use strict";(self["webpackChunktest"]=self["webpackChunktest"]||[]).push([[211],{4752:function(e,t,o){o.d(t,{j:function(){return d}});var n=o(5940),r=o(821);let a=(0,r.ref)(!1),d=(0,r.reactive)({show:!0,mode:"edit",options:{"editor-active":!1},nodes:{list:[],fields:[]},active:(0,r.computed)((()=>(0,n.V)(a.value))),triggerNode:e=>{a.value=e}})},5940:function(e,t,o){o.d(t,{V:function(){return f}});var n=o(821),r=o(4636),a=o(4752);let d=e=>async()=>{try{let t=await r.F.crud("node-tree/node").init(e.node).read(["hydrate:<="]);r.F.utils.object.set(e.paths.node.resolved,t,e.tree)}catch(t){}},s=e=>async()=>await r.F.crud("node-tree/root").init(e.tree.source).update(e.tree.root),c=e=>({path:e,resolved:e.join(".nodes."),index:parseInt(e.slice(-1)[0]),joined:e.join(".")}),i=e=>{let{ID:t,type:o,metaKey:n}=e.tree.source,r=[o,n,t].join("."),a=e.path.slice(0,-1),d=null;0!=a.length&&(d=c(a));let s=c(e.path);return{node:s,parent:d,source:[r,s.joined].join(".")}},p=e=>!(!e.addSibling||!e.node)&&(async()=>e.addSibling?await e.addSibling(r.F.utils.object.clone(e.node)):[]),l=e=>!!e.hasParent&&(async()=>e.parent?(e.parent.nodes=r.F.utils.array.omit(e.parent.nodes,e.paths.node.index),[]):[]),u=e=>!!e.hasParent&&(async(t,o=!0)=>{if(!e.parent||!e.paths.parent)return[];let{index:n}=e.paths.node,a=o?n+1:n;return e.parent.nodes=r.F.utils.array.insert(e.parent.nodes,a,t),e.paths.parent.path.concat(a)}),h=e=>!!e.hasNodes&&(async(t,o=0)=>e.node?(e.node.nodes=r.F.utils.array.insert(e.node.nodes,o,t),e.paths.node.path.concat(o)):[]),m=e=>!!e.node&&(a.j.nodes.list.find((t=>!(!e.node||!e.node.el)&&t.node.schema==e.node.schema))??!1),v=e=>e.schema&&e.node&&a.j.nodes.fields?a.j.nodes.fields.filter((t=>{if(e.schema)return e.schema.fields.includes(t.ID)})):[],f=e=>{if(!e)return!1;let{path:t,tree:o}=e;if(!t)return!1;let a=(0,n.reactive)({tree:o,path:(0,n.computed)({get:()=>t,set:t=>e.path=t}),paths:(0,n.computed)((()=>i(a))),hasParent:(0,n.computed)((()=>null!=a.paths.parent)),hasNodes:(0,n.computed)((()=>!!a.node&&!(!a.node.nodes||!Array.isArray(a.node.nodes)))),node:(0,n.computed)((()=>r.F.utils.object.get(a.paths.node.resolved,o))),parent:(0,n.computed)((()=>!(!a.hasParent||!a.paths.parent)&&(r.F.utils.object.get(a.paths.parent.resolved,o)??!1))),clone:(0,n.computed)((()=>p(a))),remove:(0,n.computed)((()=>l(a))),addSibling:(0,n.computed)((()=>u(a))),addInside:(0,n.computed)((()=>h(a))),schema:(0,n.computed)((()=>m(a))),editFields:(0,n.computed)((()=>v(a))),save:(0,n.computed)((()=>s(a))),hydrate:(0,n.computed)((()=>d(a)))});return!!a.node&&a}},3744:function(e,t){t.Z=(e,t)=>{const o=e.__vccOpts||e;for(const[n,r]of t)o[n]=r;return o}},7211:function(e,t,o){o.r(t),o.d(t,{default:function(){return j}});var n=o(821);function r(e,t,o,r,a,d){const s=(0,n.resolveDirective)("tooltip");return(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(e.el),(0,n.mergeProps)(e.props,{class:["pockets-node-tree-node",e.classes],onClickCapture:e.clickHandler,onMouseenter:t[0]||(t[0]=t=>e.hovered=!0),onMouseleave:t[1]||(t[1]=t=>e.hovered=!1)}),{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.nodes,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)("tree-walker"),(0,n.mergeProps)(e,{"node-id":t}),null,16,["node-id"])))),256))])),_:1},16,["onClickCapture","class"])),[[s,{content:e.tipContent,shown:e.showTip,triggers:[],placement:"auto-start",popperClass:"pockets-node-tree-node-overlay",delay:1}]])}var a=o(4752),d=o(5940);let s=e=>{let t=(0,n.inject)("pockets-node-tree-root")??!1;if(!t)return;let o=(0,n.ref)(!1),{path:r}=c("pockets-node-tree-path")(e),s=(0,d.V)({tree:t,path:r}),p=(0,n.computed)((()=>{if(a.j?.active&&a.j?.active?.paths&&s)return a.j?.active?.paths?.source==s.paths.source?"active":void 0})),l=(0,n.computed)((()=>a.j?.show?"editor-show":"editor-hide")),u=(0,n.computed)((()=>a.j?.active?"editor-open":"editor-closed")),h=(0,n.computed)((()=>[p.value,u.value,l.value,!0===o.value?"hovered":""])),m=(0,n.computed)((()=>!!a.j?.show&&1==o.value)),v=i(s);return{clickHandler:()=>{if(t&&a.j.show)return a.j.triggerNode({path:r,tree:t})},hovered:o,classes:h,editor:a.j,api:s,showTip:m,tipContent:(0,n.computed)((()=>v.map((e=>e.schema.title)).join(" > ")))}},c=e=>t=>{let o=(0,n.inject)(e,[]),r=[...o,t.nodeId];return(0,n.provide)(e,r),{path:r}},i=e=>{let t="a-test-of-this",o=(0,n.inject)(t,[]),r=[...o,e];return(0,n.provide)(t,r),r},p={nodeId:{type:[String,Number],required:!0},el:String,nodes:{type:Array},props:Object,data:Object,schema:String};var l={name:"tree-walker",setup:s,props:p},u=o(3744);const h=(0,u.Z)(l,[["render",r]]);var m=h,v=(0,n.defineComponent)({__name:"index",props:{root:{type:Object,required:!0},source:{type:Object}},setup(e){const t=e;return(0,n.provide)("pockets-node-tree-root",t),(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(m),(0,n.mergeProps)(e.root,{"node-id":"root"}),null,16))}});const f=v;var j=f}}]);
//# sourceMappingURL=211.23207a8f.js.map